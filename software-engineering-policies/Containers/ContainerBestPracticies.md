## Container  Best Practices

### Must Do

* Where a container needs to use Secrets, those secrets should be injected into the container via environmeny variables and should be encrypted at a minimum. Where applicable secrets should be sought via means such as Azure KeyVault, AWS Secrets Manager.
* All containers yaml files should define the resource, limits and requests for CPU and Memory consumption to enable horizontal pod auto scaling. 
* All containers deployed into environments should utilise infrastructure as code to deploy and configure the clusters and envitonments.
* All Pods should be deployed with readiness and liveliness probes configured.
* Environments above Dev should have HTTPS enforced and Http to Http redirects enabled.
* Logs generated by the containers should be consumed for interigation by third party tooling. 
* Access to he underlying infrastructure running the container images should be blocked in all environments above Dev.
* Container images should be scanned by a Container Dependency Vulnerability Scanning tool.
* When creating container images aim to use minimal dependencies, such as “Distroless” container base images:  <https://github.com/GoogleContainerTools/distroless>.
* When scoping privileges within the docker runtimes, focus on the principal of least privilege, avoid running as root.
* Ensure there is a well established process for updating dependencies.

### Should do

* Zero trust, Microservices/containers should communicate only with who they need to locked down by policy (ingress/egress)
* Access Policies, Network security Groups should be applied
* Namespace all containers
* Monitoring solution - ELK (.Net) EFK (Java) stacks, Graphana, Prome...(learn to spell)
* Utilise automated deployments on version increments within the container registry out to the nominated environment (eg dev)

### Could do

* Utilise DAPR for sidecar third party component management (queues, DB's etc)
* Utilise native built in support within visual studio for Docker
* Utilise Docker Compose to stub other dependencies that container utilises

## Best practice guides

<https://sysdig.com/blog/dockerfile-best-practices/>

Some notes from a previous principal dev on Docker/containers

1. Skills - we should look to keep stacks quite similar amongst the different teams within Software Engineering (without stifling innovation), to facilitate rotation but also the transfer of services from team to support team. I would not want a delivery to be using containers and the destination support team to have no skills in them. This could arguably be covered as part of the handover and up front support design of a solution, but may differ from team to team. Do we need formal training in containers across SE? Or probably at the very least guidance on the use of, to prevent teams achieving the same thing in 100 different ways?

1. Security - should we have a centralised container registry? As containers work from images pulled from the internet (albeit a supposedly "trusted" source such as Docker hub), do we need more rigour around that? When we spoke about containers a while back - when we had the ALM team - the vision was that they would own a central container registry that teams would pull from. If a team wanted a new container, this would firstly be added to our registry and the team would pull from there. This would enable a sheep-dip of container images, if we thought this was necessary (ITSO should have a say here).

